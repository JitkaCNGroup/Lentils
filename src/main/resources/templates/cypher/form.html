<!DOCTYPE html>
<html lang="cz"
      xmlns:th="http://www.springframework.org/schema/data/jaxb">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <title>CypherDetail</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <!--<script src='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.js'></script>-->
    <!--<link href='https://api.mapbox.com/mapbox.js/v3.2.0/mapbox.css' rel='stylesheet' />-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
    <!--<link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"-->
          <!--integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="-->
          <!--crossorigin=""/>-->
</head>
<body>
    <div class="container">
        <h2><span th:text="${heading}">Nadpis</span></h2>
        <form action="#" th:action="@{/cypher/save}" th:object="${cypher}" method="post">
            <div class="table-responsive">
                <table class="table" style="font-size: 18px">
                    <tr>
                        <td>Id</td>
                        <td><input th:field="*{cypherId}" readonly/></td>
                    </tr>
                    <tr>
                        <td>Jméno</td>
                        <td><input th:field="*{name}"/></td>
                    </tr>
                    <tr>
                        <td>Pořadí</td>
                        <td><input type="number" th:field="*{stage}"/></td>
                    </tr>
                    <tr>
                        <td>Souřadnice</td>
                        <td><input id="latLng" type="text" th:field="*{location}" readonly/></td>
                    </tr>
                    <tr>
                        <td>Odpověď</td>
                        <td><input type="text" th:field="*{codeword}"/></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td><input type="submit" value="Uložit"/>
                        </td>
                    </tr>
                </table>
            </div>
        </form>
    </div>
    <div id='map' style='width: 100%; height: 300px;'></div>
    <script>
        var map;
        var activeMarker;

        function initMap() {
            var locationOfZlin = {lat: 49.22439, lng: 17.66485};

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 14,
                center: locationOfZlin
            });

            map.addListener('click', function(event) {
                deleteMarker();
                addMarker(event.latLng);
                fillLocationToForm(event);
            });

            addMarkerFromForm();
        }

        function addMarker(location) {
            activeMarker = new google.maps.Marker({
                position: location,
                map: map
            });
        }

        function fillLocationToForm(event) {
            document.getElementById('latLng').value = event.latLng.lat() + ',' + event.latLng.lng();
        }

        function deleteMarker() {
            if (activeMarker) {
                activeMarker.setMap(null);
            }
        }

        function addMarkerFromForm() {
            var latlng = document.getElementById('latLng').value;
            if (latlng) {
                var toupleLatLng = latlng.split(",")
                var lat = parseFloat(toupleLatLng[0]);
                var lng = parseFloat(toupleLatLng[1]);
                var latLngObject = {lat: lat, lng: lng};
                addMarker(latLngObject)
            }
        }

    </script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDseyIGXP_QJWmaCbjVJxxVUQ5vxX44Anw&callback=initMap">
    </script>
</body>
</html>

